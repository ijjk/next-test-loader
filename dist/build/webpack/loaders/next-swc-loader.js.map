{"version":3,"sources":["build/webpack/loaders/next-swc-loader.js"],"sourcesContent":["/*\nCopyright (c) 2017 The swc Project Developers\n\nPermission is hereby granted, free of charge, to any\nperson obtaining a copy of this software and associated\ndocumentation files (the \"Software\"), to deal in the\nSoftware without restriction, including without\nlimitation the rights to use, copy, modify, merge,\npublish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software\nis furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice\nshall be included in all copies or substantial portions\nof the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF\nANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED\nTO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\nPARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT\nSHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\nCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\nOF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR\nIN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER\nDEALINGS IN THE SOFTWARE.\n*/\n\nimport { getOptions } from 'next/dist/compiled/loader-utils'\nconst { transform, transformSync } = require('../../swc/core')\n\nfunction makeLoader() {\n  return function (source, inputSourceMap) {\n    // Make the loader async\n    const callback = this.async()\n    const filename = this.resourcePath\n\n    let loaderOptions = getOptions(this) || {}\n\n    // Standardize on 'sourceMaps' as the key passed through to Webpack, so that\n    // users may safely use either one alongside our default use of\n    // 'this.sourceMap' below without getting error about conflicting aliases.\n    if (\n      Object.prototype.hasOwnProperty.call(loaderOptions, 'sourceMap') &&\n      !Object.prototype.hasOwnProperty.call(loaderOptions, 'sourceMaps')\n    ) {\n      loaderOptions = Object.assign({}, loaderOptions, {\n        sourceMaps: loaderOptions.sourceMap,\n      })\n      delete loaderOptions.sourceMap\n    }\n\n    if (inputSourceMap) {\n      inputSourceMap = JSON.stringify(inputSourceMap)\n    }\n\n    const programmaticOptions = Object.assign({}, loaderOptions, {\n      filename,\n      inputSourceMap: inputSourceMap || undefined,\n\n      // Set the default sourcemap behavior based on Webpack's mapping flag,\n      // but allow users to override if they want.\n      sourceMaps:\n        loaderOptions.sourceMaps === undefined\n          ? this.sourceMap\n          : loaderOptions.sourceMaps,\n\n      // Ensure that Webpack will get a full absolute path in the sourcemap\n      // so that it can properly map the module back to its internal cached\n      // modules.\n      sourceFileName: filename,\n    })\n    if (!programmaticOptions.inputSourceMap) {\n      delete programmaticOptions.inputSourceMap\n    }\n\n    const sync = programmaticOptions.sync\n    const parseMap = programmaticOptions.parseMap\n\n    // Remove loader related options\n    delete programmaticOptions.sync\n    delete programmaticOptions.parseMap\n    delete programmaticOptions.customize\n    delete programmaticOptions.cacheDirectory\n    delete programmaticOptions.cacheIdentifier\n    delete programmaticOptions.cacheCompression\n    delete programmaticOptions.metadataSubscribers\n\n    // auto detect development mode\n    if (\n      this.mode &&\n      programmaticOptions.jsc &&\n      programmaticOptions.jsc.transform &&\n      programmaticOptions.jsc.transform.react &&\n      !Object.prototype.hasOwnProperty.call(\n        programmaticOptions.jsc.transform.react,\n        'development'\n      )\n    ) {\n      programmaticOptions.jsc.transform.react.development =\n        this.mode === 'development'\n    }\n\n    if (programmaticOptions.sourceMaps === 'inline') {\n      // Babel has this weird behavior where if you set \"inline\", we\n      // inline the sourcemap, and set 'result.map = null'. This results\n      // in bad behavior from Babel since the maps get put into the code,\n      // which Webpack does not expect, and because the map we return to\n      // Webpack is null, which is also bad. To avoid that, we override the\n      // behavior here so \"inline\" just behaves like 'true'.\n      programmaticOptions.sourceMaps = true\n    }\n\n    try {\n      if (sync) {\n        const output = transformSync(source, programmaticOptions)\n        callback(\n          null,\n          output.code,\n          parseMap ? JSON.parse(output.map) : output.map\n        )\n      } else {\n        transform(source, programmaticOptions).then(\n          (output) => {\n            callback(\n              null,\n              output.code,\n              parseMap ? JSON.parse(output.map) : output.map\n            )\n          },\n          (err) => {\n            callback(err)\n          }\n        )\n      }\n    } catch (e) {\n      callback(e)\n    }\n  }\n}\n\nmodule.exports = makeLoader()\nmodule.exports.custom = makeLoader\n"],"names":[],"mappings":"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"}