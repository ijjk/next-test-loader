"use strict";exports.__esModule=true;exports.ProfilingPlugin=exports.spans=void 0;var _tracer=require("../../tracer");const pluginName='ProfilingPlugin';const spans=new WeakMap();exports.spans=spans;class ProfilingPlugin{apply(compiler){// Only enabled when instrumentation is loaded
if(!_tracer.tracer.getCurrentSpan()){return;}compiler.hooks.compile.tap(pluginName,()=>{const span=_tracer.tracer.startSpan('webpack-compile',{attributes:{name:compiler.name}});spans.set(compiler,span);});compiler.hooks.done.tap(pluginName,()=>{spans.get(compiler).end();});compiler.hooks.compilation.tap(pluginName,compilation=>{compilation.hooks.buildModule.tap(pluginName,module=>{_tracer.tracer.withSpan(spans.get(compiler),()=>{const span=_tracer.tracer.startSpan('build-module');span.setAttribute('name',module.userRequest);spans.set(module,span);});});compilation.hooks.normalModuleLoader.tap(pluginName,(loaderContext,module)=>{const parentSpan=spans.get(module);loaderContext.currentTraceSpan=parentSpan;});compilation.hooks.succeedModule.tap(pluginName,module=>{spans.get(module).end();});});}}exports.ProfilingPlugin=ProfilingPlugin;
//# sourceMappingURL=profiling-plugin.js.map