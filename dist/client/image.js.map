{"version":3,"sources":["../../client/image.tsx"],"names":["VALID_LOADING_VALUES","undefined","loaders","Map","imgixLoader","cloudinaryLoader","akamaiLoader","defaultLoader","imageData","process","env","__NEXT_IMAGE_OPTS","deviceSizes","configDeviceSizes","imageSizes","configImageSizes","loader","configLoader","path","configPath","domains","configDomains","sort","a","b","cachedObserver","getObserver","IntersectionObserver","window","entries","forEach","entry","isIntersecting","lazyImage","target","unLazifyImage","unobserve","rootMargin","dataset","src","srcset","style","visibility","classList","remove","getDeviceSizes","width","includes","widths","size","push","computeSrc","unoptimized","quality","largest","length","callLoader","loaderProps","load","get","root","generateSrcSet","map","w","join","generatePreload","sizes","getInt","x","parseInt","Image","priority","loading","className","height","unsized","rest","thisEl","NODE_ENV","Error","JSON","stringify","String","lazy","current","observer","observe","widthInt","heightInt","qualityInt","divStyle","imgStyle","wrapperStyle","quotient","ratio","isNaN","maxWidth","position","paddingBottom","left","top","console","warn","imgSrc","imgSrcSet","imgAttributes","srcSet","shouldPreload","normalizeSrc","slice","params","paramsString","missingValues","startsWith","parsedSrc","URL","err","error","hostname","encodeURIComponent"],"mappings":"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","sourcesContent":["import React, { ReactElement, useEffect, useRef } from 'react'\nimport Head from '../next-server/lib/head'\n\nconst VALID_LOADING_VALUES = ['lazy', 'eager', undefined] as const\ntype LoadingValue = typeof VALID_LOADING_VALUES[number]\n\nconst loaders = new Map<LoaderKey, (props: LoaderProps) => string>([\n  ['imgix', imgixLoader],\n  ['cloudinary', cloudinaryLoader],\n  ['akamai', akamaiLoader],\n  ['default', defaultLoader],\n])\n\ntype LoaderKey = 'imgix' | 'cloudinary' | 'akamai' | 'default'\n\ntype ImageData = {\n  deviceSizes: number[]\n  imageSizes: number[]\n  loader: LoaderKey\n  path: string\n  domains?: string[]\n}\n\ntype ImageProps = Omit<\n  JSX.IntrinsicElements['img'],\n  'src' | 'srcSet' | 'ref' | 'width' | 'height' | 'loading'\n> & {\n  src: string\n  quality?: number | string\n  priority?: boolean\n  loading?: LoadingValue\n  unoptimized?: boolean\n} & (\n    | { width: number | string; height: number | string; unsized?: false }\n    | { width?: number | string; height?: number | string; unsized: true }\n  )\n\nconst imageData: ImageData = process.env.__NEXT_IMAGE_OPTS as any\nconst {\n  deviceSizes: configDeviceSizes,\n  imageSizes: configImageSizes,\n  loader: configLoader,\n  path: configPath,\n  domains: configDomains,\n} = imageData\n// sort smallest to largest\nconfigDeviceSizes.sort((a, b) => a - b)\nconfigImageSizes.sort((a, b) => a - b)\n\nlet cachedObserver: IntersectionObserver\n\nfunction getObserver(): IntersectionObserver | undefined {\n  const IntersectionObserver =\n    typeof window !== 'undefined' ? window.IntersectionObserver : null\n  // Return shared instance of IntersectionObserver if already created\n  if (cachedObserver) {\n    return cachedObserver\n  }\n\n  // Only create shared IntersectionObserver if supported in browser\n  if (!IntersectionObserver) {\n    return undefined\n  }\n  return (cachedObserver = new IntersectionObserver(\n    (entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          let lazyImage = entry.target as HTMLImageElement\n          unLazifyImage(lazyImage)\n          cachedObserver.unobserve(lazyImage)\n        }\n      })\n    },\n    { rootMargin: '200px' }\n  ))\n}\n\nfunction unLazifyImage(lazyImage: HTMLImageElement): void {\n  if (lazyImage.dataset.src) {\n    lazyImage.src = lazyImage.dataset.src\n  }\n  if (lazyImage.dataset.srcset) {\n    lazyImage.srcset = lazyImage.dataset.srcset\n  }\n  lazyImage.style.visibility = 'visible'\n  lazyImage.classList.remove('__lazy')\n}\n\nfunction getDeviceSizes(width: number | undefined): number[] {\n  if (typeof width !== 'number') {\n    return configDeviceSizes\n  }\n  if (configImageSizes.includes(width)) {\n    return [width]\n  }\n  const widths: number[] = []\n  for (let size of configDeviceSizes) {\n    widths.push(size)\n    if (size >= width) {\n      break\n    }\n  }\n  return widths\n}\n\nfunction computeSrc(\n  src: string,\n  unoptimized: boolean,\n  width?: number,\n  quality?: number\n): string {\n  if (unoptimized) {\n    return src\n  }\n  const widths = getDeviceSizes(width)\n  const largest = widths[widths.length - 1]\n  return callLoader({ src, width: largest, quality })\n}\n\ntype CallLoaderProps = {\n  src: string\n  width: number\n  quality?: number\n}\n\nfunction callLoader(loaderProps: CallLoaderProps) {\n  const load = loaders.get(configLoader) || defaultLoader\n  return load({ root: configPath, ...loaderProps })\n}\n\ntype SrcSetData = {\n  src: string\n  unoptimized: boolean\n  width?: number\n  quality?: number\n}\n\nfunction generateSrcSet({\n  src,\n  unoptimized,\n  width,\n  quality,\n}: SrcSetData): string | undefined {\n  // At each breakpoint, generate an image url using the loader, such as:\n  // ' www.example.com/foo.jpg?w=480 480w, '\n  if (unoptimized) {\n    return undefined\n  }\n\n  return getDeviceSizes(width)\n    .map((w) => `${callLoader({ src, width: w, quality })} ${w}w`)\n    .join(', ')\n}\n\ntype PreloadData = {\n  src: string\n  unoptimized: boolean\n  width: number | undefined\n  sizes?: string\n  quality?: number\n}\n\nfunction generatePreload({\n  src,\n  width,\n  unoptimized = false,\n  sizes,\n  quality,\n}: PreloadData): ReactElement {\n  // This function generates an image preload that makes use of the \"imagesrcset\" and \"imagesizes\"\n  // attributes for preloading responsive images. They're still experimental, but fully backward\n  // compatible, as the link tag includes all necessary attributes, even if the final two are ignored.\n  // See: https://web.dev/preload-responsive-images/\n  return (\n    <Head>\n      <link\n        rel=\"preload\"\n        as=\"image\"\n        href={computeSrc(src, unoptimized, width, quality)}\n        // @ts-ignore: imagesrcset and imagesizes not yet in the link element type\n        imagesrcset={generateSrcSet({ src, unoptimized, width, quality })}\n        imagesizes={sizes}\n      />\n    </Head>\n  )\n}\n\nfunction getInt(x: unknown): number | undefined {\n  if (typeof x === 'number') {\n    return x\n  }\n  if (typeof x === 'string') {\n    return parseInt(x, 10)\n  }\n  return undefined\n}\n\nexport default function Image({\n  src,\n  sizes,\n  unoptimized = false,\n  priority = false,\n  loading,\n  className,\n  quality,\n  width,\n  height,\n  unsized,\n  ...rest\n}: ImageProps) {\n  const thisEl = useRef<HTMLImageElement>(null)\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (!src) {\n      throw new Error(\n        `Image is missing required \"src\" property. Make sure you pass \"src\" in props to the \\`next/image\\` component. Received: ${JSON.stringify(\n          { width, height, quality, unsized }\n        )}`\n      )\n    }\n    if (!VALID_LOADING_VALUES.includes(loading)) {\n      throw new Error(\n        `Image with src \"${src}\" has invalid \"loading\" property. Provided \"${loading}\" should be one of ${VALID_LOADING_VALUES.map(\n          String\n        ).join(',')}.`\n      )\n    }\n    if (priority && loading === 'lazy') {\n      throw new Error(\n        `Image with src \"${src}\" has both \"priority\" and \"loading=lazy\" properties. Only one should be used.`\n      )\n    }\n  }\n\n  let lazy = loading === 'lazy'\n  if (!priority && typeof loading === 'undefined') {\n    lazy = true\n  }\n\n  if (typeof window !== 'undefined' && !window.IntersectionObserver) {\n    // Rendering client side on browser without intersection observer\n    lazy = false\n  }\n\n  useEffect(() => {\n    const target = thisEl.current\n\n    if (target && lazy) {\n      const observer = getObserver()\n\n      if (observer) {\n        observer.observe(target)\n\n        return () => {\n          observer.unobserve(target)\n        }\n      } else {\n        //browsers without intersection observer\n        unLazifyImage(target)\n      }\n    }\n  }, [thisEl, lazy])\n\n  const widthInt = getInt(width)\n  const heightInt = getInt(height)\n  const qualityInt = getInt(quality)\n\n  let divStyle: React.CSSProperties | undefined\n  let imgStyle: React.CSSProperties | undefined\n  let wrapperStyle: React.CSSProperties | undefined\n  if (\n    typeof widthInt !== 'undefined' &&\n    typeof heightInt !== 'undefined' &&\n    !unsized\n  ) {\n    // <Image src=\"i.png\" width={100} height={100} />\n    // <Image src=\"i.png\" width=\"100\" height=\"100\" />\n    const quotient = heightInt / widthInt\n    const ratio = isNaN(quotient) ? 1 : quotient * 100\n    wrapperStyle = {\n      maxWidth: '100%',\n      width: widthInt,\n    }\n    divStyle = {\n      position: 'relative',\n      paddingBottom: `${ratio}%`,\n    }\n    imgStyle = {\n      visibility: lazy ? 'hidden' : 'visible',\n      height: '100%',\n      left: '0',\n      position: 'absolute',\n      top: '0',\n      width: '100%',\n    }\n  } else if (\n    typeof widthInt === 'undefined' &&\n    typeof heightInt === 'undefined' &&\n    unsized\n  ) {\n    // <Image src=\"i.png\" unsized />\n    if (process.env.NODE_ENV !== 'production') {\n      if (priority) {\n        // <Image src=\"i.png\" unsized priority />\n        console.warn(\n          `Image with src \"${src}\" has both \"priority\" and \"unsized\" properties. Only one should be used.`\n        )\n      }\n    }\n  } else {\n    // <Image src=\"i.png\" />\n    if (process.env.NODE_ENV !== 'production') {\n      throw new Error(\n        `Image with src \"${src}\" must use \"width\" and \"height\" properties or \"unsized\" property.`\n      )\n    }\n  }\n\n  // Generate attribute values\n  const imgSrc = computeSrc(src, unoptimized, widthInt, qualityInt)\n  const imgSrcSet = generateSrcSet({\n    src,\n    width: widthInt,\n    unoptimized,\n    quality: qualityInt,\n  })\n\n  let imgAttributes:\n    | {\n        src: string\n        srcSet?: string\n      }\n    | {\n        'data-src': string\n        'data-srcset'?: string\n      }\n  if (!lazy) {\n    imgAttributes = {\n      src: imgSrc,\n    }\n    if (imgSrcSet) {\n      imgAttributes.srcSet = imgSrcSet\n    }\n  } else {\n    imgAttributes = {\n      'data-src': imgSrc,\n    }\n    if (imgSrcSet) {\n      imgAttributes['data-srcset'] = imgSrcSet\n    }\n    className = className ? className + ' __lazy' : '__lazy'\n  }\n\n  // No need to add preloads on the client side--by the time the application is hydrated,\n  // it's too late for preloads\n  const shouldPreload = priority && typeof window === 'undefined'\n\n  return (\n    <div style={wrapperStyle}>\n      <div style={divStyle}>\n        {shouldPreload\n          ? generatePreload({\n              src,\n              width: widthInt,\n              unoptimized,\n              sizes,\n              quality: qualityInt,\n            })\n          : ''}\n        <img\n          {...rest}\n          {...imgAttributes}\n          className={className}\n          sizes={sizes}\n          ref={thisEl}\n          style={imgStyle}\n        />\n      </div>\n    </div>\n  )\n}\n\n//BUILT IN LOADERS\n\ntype LoaderProps = CallLoaderProps & { root: string }\n\nfunction normalizeSrc(src: string) {\n  return src[0] === '/' ? src.slice(1) : src\n}\n\nfunction imgixLoader({ root, src, width, quality }: LoaderProps): string {\n  const params = ['auto=format', 'w=' + width]\n  let paramsString = ''\n  if (quality) {\n    params.push('q=' + quality)\n  }\n\n  if (params.length) {\n    paramsString = '?' + params.join('&')\n  }\n  return `${root}${normalizeSrc(src)}${paramsString}`\n}\n\nfunction akamaiLoader({ root, src, width }: LoaderProps): string {\n  return `${root}${normalizeSrc(src)}?imwidth=${width}`\n}\n\nfunction cloudinaryLoader({ root, src, width, quality }: LoaderProps): string {\n  const params = ['f_auto', 'w_' + width]\n  let paramsString = ''\n  if (quality) {\n    params.push('q_' + quality)\n  }\n  if (params.length) {\n    paramsString = params.join(',') + '/'\n  }\n  return `${root}${paramsString}${normalizeSrc(src)}`\n}\n\nfunction defaultLoader({ root, src, width, quality }: LoaderProps): string {\n  if (process.env.NODE_ENV !== 'production') {\n    const missingValues = []\n\n    // these should always be provided but make sure they are\n    if (!src) missingValues.push('src')\n    if (!width) missingValues.push('width')\n\n    if (missingValues.length > 0) {\n      throw new Error(\n        `Next Image Optimization requires ${missingValues.join(\n          ', '\n        )} to be provided. Make sure you pass them as props to the \\`next/image\\` component. Received: ${JSON.stringify(\n          { src, width, quality }\n        )}`\n      )\n    }\n\n    if (src && !src.startsWith('/') && configDomains) {\n      let parsedSrc: URL\n      try {\n        parsedSrc = new URL(src)\n      } catch (err) {\n        console.error(err)\n        throw new Error(\n          `Failed to parse \"${src}\" in \"next/image\", if using relative image it must start with a leading slash \"/\" or be an absolute URL (http:// or https://)`\n        )\n      }\n\n      if (!configDomains.includes(parsedSrc.hostname)) {\n        throw new Error(\n          `Invalid src prop (${src}) on \\`next/image\\`, hostname \"${parsedSrc.hostname}\" is not configured under images in your \\`next.config.js\\`\\n` +\n            `See more info: https://err.sh/nextjs/next-image-unconfigured-host`\n        )\n      }\n    }\n  }\n\n  return `${root}?url=${encodeURIComponent(src)}&w=${width}&q=${quality || 75}`\n}\n"]}