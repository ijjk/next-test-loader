{"version":3,"sources":["../../client/image.tsx"],"names":["loaders","Map","imgixLoader","cloudinaryLoader","akamaiLoader","defaultLoader","imageData","process","env","__NEXT_IMAGE_OPTS","sizes","configSizes","loader","configLoader","path","configPath","cachedObserver","IntersectionObserver","window","getObserver","undefined","entries","forEach","entry","isIntersecting","lazyImage","target","dataset","src","srcset","classList","remove","unobserve","rootMargin","computeSrc","unoptimized","quality","callLoader","loaderProps","load","get","root","generateSrcSet","widths","map","width","join","generatePreload","Image","priority","lazy","className","height","unsized","rest","thisEl","NODE_ENV","console","error","current","observer","observe","imgSrc","imgSrcSet","imgAttributes","srcSet","shouldPreload","divStyle","imgStyle","quotient","ratio","isNaN","position","paddingBottom","left","top","warn","normalizeSrc","slice","params","paramsString","push","length","encodeURIComponent"],"mappings":"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","sourcesContent":["import React, { ReactElement, useEffect, useRef } from 'react'\nimport Head from '../next-server/lib/head'\n\nconst loaders = new Map<LoaderKey, (props: LoaderProps) => string>([\n  ['imgix', imgixLoader],\n  ['cloudinary', cloudinaryLoader],\n  ['akamai', akamaiLoader],\n  ['default', defaultLoader],\n])\n\ntype LoaderKey = 'imgix' | 'cloudinary' | 'akamai' | 'default'\n\ntype ImageData = {\n  sizes: number[]\n  loader: LoaderKey\n  path: string\n}\n\ntype ImageProps = Omit<\n  JSX.IntrinsicElements['img'],\n  'src' | 'srcSet' | 'ref' | 'width' | 'height'\n> & {\n  src: string\n  quality?: string\n  priority?: boolean\n  lazy?: boolean\n  unoptimized?: boolean\n} & (\n    | { width: number; height: number; unsized?: false }\n    | { width?: number; height?: number; unsized: true }\n  )\n\nconst imageData: ImageData = process.env.__NEXT_IMAGE_OPTS as any\nconst { sizes: configSizes, loader: configLoader, path: configPath } = imageData\n\nlet cachedObserver: IntersectionObserver\nconst IntersectionObserver =\n  typeof window !== 'undefined' ? window.IntersectionObserver : null\n\nfunction getObserver(): IntersectionObserver | undefined {\n  // Return shared instance of IntersectionObserver if already created\n  if (cachedObserver) {\n    return cachedObserver\n  }\n\n  // Only create shared IntersectionObserver if supported in browser\n  if (!IntersectionObserver) {\n    return undefined\n  }\n\n  return (cachedObserver = new IntersectionObserver(\n    (entries) => {\n      entries.forEach((entry) => {\n        if (entry.isIntersecting) {\n          let lazyImage = entry.target as HTMLImageElement\n          if (lazyImage.dataset.src) {\n            lazyImage.src = lazyImage.dataset.src\n          }\n          if (lazyImage.dataset.srcset) {\n            lazyImage.srcset = lazyImage.dataset.srcset\n          }\n          lazyImage.classList.remove('__lazy')\n          cachedObserver.unobserve(lazyImage)\n        }\n      })\n    },\n    { rootMargin: '200px' }\n  ))\n}\n\nfunction computeSrc(\n  src: string,\n  unoptimized: boolean,\n  quality?: string\n): string {\n  if (unoptimized) {\n    return src\n  }\n  return callLoader({ src, quality })\n}\n\ntype CallLoaderProps = {\n  src: string\n  width?: number\n  quality?: string\n}\n\nfunction callLoader(loaderProps: CallLoaderProps) {\n  let load = loaders.get(configLoader) || defaultLoader\n  return load({ root: configPath, ...loaderProps })\n}\n\ntype SrcSetData = {\n  src: string\n  widths: number[]\n  quality?: string\n}\n\nfunction generateSrcSet({ src, widths, quality }: SrcSetData): string {\n  // At each breakpoint, generate an image url using the loader, such as:\n  // ' www.example.com/foo.jpg?w=480 480w, '\n  return widths\n    .map((width: number) => `${callLoader({ src, width, quality })} ${width}w`)\n    .join(', ')\n}\n\ntype PreloadData = {\n  src: string\n  widths: number[]\n  sizes?: string\n  unoptimized?: boolean\n  quality?: string\n}\n\nfunction generatePreload({\n  src,\n  widths,\n  unoptimized = false,\n  sizes,\n  quality,\n}: PreloadData): ReactElement {\n  // This function generates an image preload that makes use of the \"imagesrcset\" and \"imagesizes\"\n  // attributes for preloading responsive images. They're still experimental, but fully backward\n  // compatible, as the link tag includes all necessary attributes, even if the final two are ignored.\n  // See: https://web.dev/preload-responsive-images/\n  return (\n    <Head>\n      <link\n        rel=\"preload\"\n        as=\"image\"\n        href={computeSrc(src, unoptimized, quality)}\n        // @ts-ignore: imagesrcset and imagesizes not yet in the link element type\n        imagesrcset={generateSrcSet({ src, widths, quality })}\n        imagesizes={sizes}\n      />\n    </Head>\n  )\n}\n\nexport default function Image({\n  src,\n  sizes,\n  unoptimized = false,\n  priority = false,\n  lazy = false,\n  className,\n  quality,\n  width,\n  height,\n  unsized,\n  ...rest\n}: ImageProps) {\n  const thisEl = useRef<HTMLImageElement>(null)\n\n  // Sanity Checks:\n  // If priority and lazy are present, log an error and use priority only.\n  if (priority && lazy) {\n    if (process.env.NODE_ENV !== 'production') {\n      console.error(\n        `Image with src ${src} has both priority and lazy tags. Only one should be used.`\n      )\n    }\n    lazy = false\n  }\n\n  useEffect(() => {\n    const target = thisEl.current\n\n    if (target && lazy) {\n      const observer = getObserver()\n\n      if (observer) {\n        observer.observe(target)\n\n        return () => {\n          observer.unobserve(target)\n        }\n      }\n    }\n  }, [thisEl, lazy])\n\n  // Generate attribute values\n  const imgSrc = computeSrc(src, unoptimized, quality)\n  const imgSrcSet = !unoptimized\n    ? generateSrcSet({\n        src,\n        widths: configSizes,\n        quality,\n      })\n    : undefined\n\n  let imgAttributes:\n    | {\n        src: string\n        srcSet?: string\n      }\n    | {\n        'data-src': string\n        'data-srcset'?: string\n      }\n  if (!lazy) {\n    imgAttributes = {\n      src: imgSrc,\n    }\n    if (imgSrcSet) {\n      imgAttributes.srcSet = imgSrcSet\n    }\n  } else {\n    imgAttributes = {\n      'data-src': imgSrc,\n    }\n    if (imgSrcSet) {\n      imgAttributes['data-srcset'] = imgSrcSet\n    }\n    className = className ? className + ' __lazy' : '__lazy'\n  }\n\n  // No need to add preloads on the client side--by the time the application is hydrated,\n  // it's too late for preloads\n  const shouldPreload = priority && typeof window === 'undefined'\n\n  let divStyle: React.CSSProperties | undefined\n  let imgStyle: React.CSSProperties | undefined\n  if (typeof height === 'number' && typeof width === 'number' && !unsized) {\n    // <Image src=\"i.png\" width=100 height=100 />\n    const quotient = height / width\n    const ratio = isNaN(quotient) ? 1 : quotient * 100\n    divStyle = {\n      position: 'relative',\n      paddingBottom: `${ratio}%`,\n    }\n    imgStyle = {\n      height: '100%',\n      left: '0',\n      position: 'absolute',\n      top: '0',\n      width: '100%',\n    }\n  } else if (\n    typeof height === 'undefined' &&\n    typeof width === 'undefined' &&\n    unsized\n  ) {\n    // <Image src=\"i.png\" unsized />\n    if (process.env.NODE_ENV !== 'production') {\n      if (priority) {\n        // <Image src=\"i.png\" unsized priority />\n        console.warn(\n          `Image with src ${src} has both priority and unsized attributes. Only one should be used.`\n        )\n      }\n    }\n  } else {\n    if (process.env.NODE_ENV !== 'production') {\n      console.error(\n        `Image with src ${src} must use width and height attributes or unsized attribute.`\n      )\n    }\n  }\n\n  return (\n    <div style={divStyle}>\n      {shouldPreload\n        ? generatePreload({\n            src,\n            widths: configSizes,\n            unoptimized,\n            sizes,\n          })\n        : ''}\n      <img\n        {...rest}\n        {...imgAttributes}\n        className={className}\n        sizes={sizes}\n        ref={thisEl}\n        style={imgStyle}\n      />\n    </div>\n  )\n}\n\n//BUILT IN LOADERS\n\ntype LoaderProps = CallLoaderProps & { root: string }\n\nfunction normalizeSrc(src: string) {\n  return src[0] === '/' ? src.slice(1) : src\n}\n\nfunction imgixLoader({ root, src, width, quality }: LoaderProps): string {\n  const params = ['auto=format']\n  let paramsString = ''\n  if (width) {\n    params.push('w=' + width)\n  }\n  if (quality) {\n    params.push('q=' + quality)\n  }\n\n  if (params.length) {\n    paramsString = '?' + params.join('&')\n  }\n  return `${root}${normalizeSrc(src)}${paramsString}`\n}\n\nfunction akamaiLoader({ root, src, width }: LoaderProps): string {\n  return `${root}${normalizeSrc(src)}${width ? '?imwidth=' + width : ''}`\n}\n\nfunction cloudinaryLoader({ root, src, width, quality }: LoaderProps): string {\n  const params = ['f_auto']\n  let paramsString = ''\n  if (width) {\n    params.push('w_' + width)\n  }\n  if (quality) {\n    params.push('q_' + quality)\n  }\n  if (params.length) {\n    paramsString = params.join(',') + '/'\n  }\n  return `${root}${paramsString}${normalizeSrc(src)}`\n}\n\nfunction defaultLoader({ root, src, width, quality }: LoaderProps): string {\n  return `${root}?url=${encodeURIComponent(src)}&${\n    width ? `w=${width}&` : ''\n  }q=${quality || '100'}`\n}\n"]}