{"version":3,"sources":["../../client/page-loader.ts"],"names":["looseToArray","input","slice","call","hasRel","rel","link","document","createElement","relList","supports","pageLoadError","route","Error","INITIAL_CSS_LOAD_ERROR","Symbol","relPrefetch","hasNoModule","normalizeRoute","replace","appendLink","href","as","Promise","res","rej","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","head","appendChild","loadScript","url","script","__NEXT_MODERN_BUILD","type","src","body","PageLoader","constructor","buildId","assetPrefix","initialPage","pageCache","cssc","pageRegisterEvents","loadingRoutes","promisedBuildManifest","promisedSsgManifest","promisedDevPagesManifest","resolve","window","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","__SSG_MANIFEST","__SSG_MANIFEST_CB","getPageList","NODE_ENV","then","buildManifest","sortedPages","__DEV_PAGES_MANIFEST","pages","fetch","json","manifest","catch","err","console","log","fetchStyleSheet","ok","text","getDependencies","m","map","encodeURI","reject","getDataHref","asPath","ssg","locale","pathname","hrefPathname","query","search","asPathname","getHrefForSlug","path","dataRoute","isDynamic","interpolatedRoute","result","_isSsg","s","has","loadPage","cachedPage","error","fire","pageToCache","off","on","deps","pending","forEach","d","endsWith","querySelector","push","all","scriptRoute","registerPage","regFn","register","styleSheets","mod","pageData","page","default","emit","module","hot","status","check","removeStatusHandler","isInitialLoad","promisedDeps","querySelectorAll","e","getAttribute","filter","cssFiles","Object","defineProperty","prefetch","isDependency","cn","navigator","connection","saveData","test","effectiveType","ext","encodeURIComponent","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import { ComponentType } from 'react'\nimport type { ClientSsgManifest } from '../build'\nimport type { ClientBuildManifest } from '../build/webpack/plugins/build-manifest-plugin'\nimport type { MittEmitter } from '../next-server/lib/mitt'\nimport mitt from '../next-server/lib/mitt'\nimport {\n  addBasePath,\n  addLocale,\n  interpolateAs,\n  markLoadingError,\n} from '../next-server/lib/router/router'\nimport getAssetPathFromRoute from '../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from '../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from '../next-server/lib/router/utils/parse-relative-url'\n\nexport const looseToArray = <T extends {}>(input: any): T[] =>\n  [].slice.call(input)\n\nfunction hasRel(rel: string, link?: HTMLLinkElement) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route: string) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nexport const INITIAL_CSS_LOAD_ERROR = Symbol('INITIAL_CSS_LOAD_ERROR')\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nfunction normalizeRoute(route: string) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nfunction appendLink(\n  href: string,\n  rel: string,\n  as?: string,\n  link?: HTMLLinkElement\n): Promise<any> {\n  return new Promise((res, rej) => {\n    link = document.createElement('link')\n\n    // The order of property assignment here is intentional:\n    if (as) link!.as = as\n    link!.rel = rel\n    link!.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    link!.onload = res\n    link!.onerror = rej\n\n    // `href` should always be last:\n    link!.href = href\n\n    document.head.appendChild(link)\n  })\n}\n\nfunction loadScript(url: string): Promise<any> {\n  return new Promise((res, rej) => {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    script.src = url\n    script.onload = res\n    script.onerror = () => rej(pageLoadError(url))\n    document.body.appendChild(script)\n  })\n}\n\nexport type StyleSheetTuple = { href: string; text: string }\nexport type GoodPageCache = {\n  page: ComponentType\n  mod: any\n  styleSheets: StyleSheetTuple[]\n}\nexport type PageCacheEntry = { error: any } | GoodPageCache\n\nexport default class PageLoader {\n  private initialPage: string\n  private buildId: string\n  private assetPrefix: string\n  private pageCache: Record<string, PageCacheEntry>\n  private cssc: Record<string, Promise<string>>\n  private pageRegisterEvents: MittEmitter\n  private loadingRoutes: Record<string, boolean>\n  private promisedBuildManifest?: Promise<ClientBuildManifest>\n  private promisedSsgManifest?: Promise<ClientSsgManifest>\n  private promisedDevPagesManifest?: Promise<any>\n\n  constructor(buildId: string, assetPrefix: string, initialPage: string) {\n    this.initialPage = initialPage\n\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.cssc = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    this.promisedBuildManifest = new Promise((resolve) => {\n      if ((window as any).__BUILD_MANIFEST) {\n        resolve((window as any).__BUILD_MANIFEST)\n      } else {\n        ;(window as any).__BUILD_MANIFEST_CB = () => {\n          resolve((window as any).__BUILD_MANIFEST)\n        }\n      }\n    })\n\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if ((window as any).__SSG_MANIFEST) {\n        resolve((window as any).__SSG_MANIFEST)\n      } else {\n        ;(window as any).__SSG_MANIFEST_CB = () => {\n          resolve((window as any).__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  getPageList() {\n    if (process.env.NODE_ENV === 'production') {\n      return this.promisedBuildManifest!.then(\n        (buildManifest) => buildManifest.sortedPages\n      )\n    } else {\n      if ((window as any).__DEV_PAGES_MANIFEST) {\n        return (window as any).__DEV_PAGES_MANIFEST.pages\n      } else {\n        if (!this.promisedDevPagesManifest) {\n          this.promisedDevPagesManifest = fetch(\n            `${this.assetPrefix}/_next/static/development/_devPagesManifest.json`\n          )\n            .then((res) => res.json())\n            .then((manifest) => {\n              ;(window as any).__DEV_PAGES_MANIFEST = manifest\n              return manifest.pages\n            })\n            .catch((err) => {\n              console.log(`Failed to fetch devPagesManifest`, err)\n            })\n        }\n        return this.promisedDevPagesManifest\n      }\n    }\n  }\n\n  private fetchStyleSheet(href: string): Promise<StyleSheetTuple> {\n    if (!this.cssc[href]) {\n      this.cssc[href] = fetch(href).then((res) => {\n        if (!res.ok) throw pageLoadError(href)\n        return res.text()\n      })\n    }\n    return this.cssc[href].then((text) => ({ href, text }))\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  private getDependencies(route: string): Promise<string[]> {\n    return this.promisedBuildManifest!.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : Promise.reject(pageLoadError(route))\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(\n    href: string,\n    asPath: string,\n    ssg: boolean,\n    locale?: string | false\n  ) {\n    const { pathname: hrefPathname, query, search } = parseRelativeUrl(href)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (path: string) => {\n      const dataRoute = getAssetPathFromRoute(addLocale(path, locale), '.json')\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    const isDynamic: boolean = isDynamicRoute(route)\n    const interpolatedRoute = isDynamic\n      ? interpolateAs(hrefPathname, asPathname, query).result\n      : ''\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   */\n  _isSsg(href: string): Promise<boolean> {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest!.then((s: ClientSsgManifest) =>\n      s.has(route)\n    )\n  }\n\n  loadPage(route: string): Promise<GoodPageCache> {\n    route = normalizeRoute(route)\n\n    return new Promise<GoodPageCache>((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        if ('error' in cachedPage) {\n          reject(cachedPage.error)\n        } else {\n          resolve(cachedPage)\n        }\n        return\n      }\n\n      const fire = (pageToCache: PageCacheEntry) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if ('error' in pageToCache) {\n          reject(pageToCache.error)\n        } else {\n          resolve(pageToCache)\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route)\n            .then((deps) => {\n              const pending: Promise<any>[] = []\n              deps.forEach((d) => {\n                if (\n                  d.endsWith('.js') &&\n                  !document.querySelector(`script[src^=\"${d}\"]`)\n                ) {\n                  pending.push(loadScript(d))\n                }\n                if (d.endsWith('.css')) {\n                  pending.push(this.fetchStyleSheet(d))\n                }\n              })\n              return Promise.all(pending)\n            })\n            .catch((err) => {\n              // Mark the page as failed to load if any of its required scripts\n              // fail to load:\n              this.pageCache[route] = { error: err }\n              fire({ error: err })\n            })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          loadScript(url).catch((err) => {\n            // Mark the page as failed to load if its script fails to load:\n            this.pageCache[route] = { error: err }\n            fire({ error: err })\n          })\n        }\n      }\n    })\n  }\n\n  // This method if called by the route code.\n  registerPage(route: string, regFn: () => any) {\n    const register = async (styleSheets: StyleSheetTuple[]) => {\n      try {\n        const mod = await regFn()\n        const pageData: PageCacheEntry = {\n          page: mod.default || mod,\n          mod,\n          styleSheets,\n        }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if ((module as any).hot && (module as any).hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status: string) => {\n          if (status === 'idle') {\n            ;(module as any).hot.removeStatusHandler(check)\n            register(\n              /* css is handled via style-loader in development */\n              []\n            )\n          }\n        }\n        ;(module as any).hot.status(check)\n        return\n      }\n    }\n\n    const isInitialLoad = route === this.initialPage\n    const promisedDeps: Promise<StyleSheetTuple[]> =\n      // Shared styles will already be on the page:\n      route === '/_app' ||\n      // We use `style-loader` in development:\n      process.env.NODE_ENV !== 'production'\n        ? Promise.resolve([])\n        : // Tests that this does not block hydration:\n          // test/integration/css-fixtures/hydrate-without-deps/\n          (isInitialLoad\n            ? Promise.resolve(\n                looseToArray<HTMLLinkElement>(\n                  document.querySelectorAll('link[data-n-p]')\n                ).map((e) => e.getAttribute('href')!)\n              )\n            : this.getDependencies(route).then((deps) =>\n                deps.filter((d) => d.endsWith('.css'))\n              )\n          ).then((cssFiles) =>\n            // These files should've already been fetched by now, so this\n            // should resolve instantly.\n            Promise.all(cssFiles.map((d) => this.fetchStyleSheet(d))).catch(\n              (err) => {\n                if (isInitialLoad) {\n                  Object.defineProperty(err, INITIAL_CSS_LOAD_ERROR, {})\n                }\n                throw err\n              }\n            )\n          )\n    promisedDeps.then(\n      (deps) => register(deps),\n      (error) => {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    )\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route: string, isDependency?: boolean): Promise<void> {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = (navigator as any).connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all([\n      url\n        ? url.endsWith('.css')\n          ? this.fetchStyleSheet(url)\n          : !document.querySelector(\n              `link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`\n            ) && appendLink(url, relPrefetch, 'script')\n        : 0,\n      process.env.NODE_ENV === 'production' &&\n        !isDependency &&\n        this.getDependencies(route).then((urls) =>\n          Promise.all(\n            urls.map((dependencyUrl) => this.prefetch(dependencyUrl, true))\n          )\n        ),\n    ]).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]}