{"version":3,"sources":["../../client/page-loader.ts"],"names":["hasRel","rel","link","document","createElement","relList","supports","pageLoadError","route","Error","relPrefetch","relPreload","hasNoModule","requestIdleCallback","window","cb","setTimeout","normalizeRoute","replace","createLink","href","as","Promise","res","rej","crossOrigin","process","env","__NEXT_CROSS_ORIGIN","onload","onerror","appendLink","head","appendChild","loadScript","url","script","__NEXT_MODERN_BUILD","type","src","body","PageLoader","constructor","buildId","assetPrefix","initialPage","initialStyleSheets","pageCache","pageRegisterEvents","loadingRoutes","promisedBuildManifest","promisedSsgManifest","promisedDevPagesManifest","resolve","__BUILD_MANIFEST","__BUILD_MANIFEST_CB","__SSG_MANIFEST","__SSG_MANIFEST_CB","getPageList","NODE_ENV","then","buildManifest","sortedPages","__DEV_PAGES_MANIFEST","pages","fetch","json","manifest","catch","err","console","log","getDependencies","m","map","encodeURI","reject","getDataHref","asPath","ssg","pathname","hrefPathname","searchParams","search","query","asPathname","getHrefForSlug","path","dataRoute","isDynamic","interpolatedRoute","dynamicRegex","dynamicGroups","groups","dynamicMatches","Object","keys","every","param","value","repeat","optional","replaced","Array","isArray","escapePathDelimiters","join","prefetchData","s","_dataHref","has","querySelector","loadPage","cachedPage","error","fire","pageToCache","off","on","deps","pending","forEach","d","endsWith","push","all","scriptRoute","registerPage","regFn","register","styleSheets","mod","pageData","page","default","emit","module","hot","status","check","removeStatusHandler","promisedDeps","filter","prefetch","isDependency","cn","navigator","connection","saveData","test","effectiveType","ext","encodeURIComponent","urls","dependencyUrl"],"mappings":"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","sourcesContent":["import { ComponentType } from 'react'\nimport type { ClientSsgManifest } from '../build'\nimport type { ClientBuildManifest } from '../build/webpack/plugins/build-manifest-plugin'\nimport mitt from '../next-server/lib/mitt'\nimport type { MittEmitter } from '../next-server/lib/mitt'\nimport { addBasePath, markLoadingError } from '../next-server/lib/router/router'\nimport escapePathDelimiters from '../next-server/lib/router/utils/escape-path-delimiters'\nimport getAssetPathFromRoute from '../next-server/lib/router/utils/get-asset-path-from-route'\nimport { isDynamicRoute } from '../next-server/lib/router/utils/is-dynamic'\nimport { parseRelativeUrl } from '../next-server/lib/router/utils/parse-relative-url'\nimport { searchParamsToUrlQuery } from '../next-server/lib/router/utils/querystring'\nimport { getRouteMatcher } from '../next-server/lib/router/utils/route-matcher'\nimport { getRouteRegex } from '../next-server/lib/router/utils/route-regex'\n\nfunction hasRel(rel: string, link?: HTMLLinkElement) {\n  try {\n    link = document.createElement('link')\n    return link.relList.supports(rel)\n  } catch {}\n}\n\nfunction pageLoadError(route: string) {\n  return markLoadingError(new Error(`Error loading ${route}`))\n}\n\nconst relPrefetch =\n  hasRel('preload') && !hasRel('prefetch')\n    ? // https://caniuse.com/#feat=link-rel-preload\n      // macOS and iOS (Safari does not support prefetch)\n      'preload'\n    : // https://caniuse.com/#feat=link-rel-prefetch\n      // IE 11, Edge 12+, nearly all evergreen\n      'prefetch'\n\nconst relPreload = hasRel('preload') ? 'preload' : relPrefetch\n\nconst hasNoModule = 'noModule' in document.createElement('script')\n\nconst requestIdleCallback: (fn: () => void) => void =\n  (window as any).requestIdleCallback ||\n  function (cb: () => void) {\n    return setTimeout(cb, 1)\n  }\n\nfunction normalizeRoute(route: string) {\n  if (route[0] !== '/') {\n    throw new Error(`Route name should start with a \"/\", got \"${route}\"`)\n  }\n\n  if (route === '/') return route\n  return route.replace(/\\/$/, '')\n}\n\nexport function createLink(\n  href: string,\n  rel: string,\n  as?: string,\n  link?: HTMLLinkElement\n): [HTMLLinkElement, Promise<any>] {\n  link = document.createElement('link')\n  return [\n    link,\n    new Promise((res, rej) => {\n      // The order of property assignment here is intentional:\n      if (as) link!.as = as\n      link!.rel = rel\n      link!.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n      link!.onload = res\n      link!.onerror = rej\n\n      // `href` should always be last:\n      link!.href = href\n    }),\n  ]\n}\n\nfunction appendLink(href: string, rel: string, as?: string): Promise<any> {\n  const [link, res] = createLink(href, rel, as)\n  document.head.appendChild(link)\n  return res\n}\n\nfunction loadScript(url: string): Promise<any> {\n  return new Promise((res, rej) => {\n    const script = document.createElement('script')\n    if (process.env.__NEXT_MODERN_BUILD && hasNoModule) {\n      script.type = 'module'\n    }\n    script.crossOrigin = process.env.__NEXT_CROSS_ORIGIN!\n    script.src = url\n    script.onload = res\n    script.onerror = () => rej(pageLoadError(url))\n    document.body.appendChild(script)\n  })\n}\n\nexport type GoodPageCache = {\n  page: ComponentType\n  mod: any\n  styleSheets: string[]\n}\nexport type PageCacheEntry = { error: any } | GoodPageCache\n\nexport default class PageLoader {\n  private initialPage: string\n  private initialStyleSheets: string[]\n  private buildId: string\n  private assetPrefix: string\n  private pageCache: Record<string, PageCacheEntry>\n  private pageRegisterEvents: MittEmitter\n  private loadingRoutes: Record<string, boolean>\n  private promisedBuildManifest?: Promise<ClientBuildManifest>\n  private promisedSsgManifest?: Promise<ClientSsgManifest>\n  private promisedDevPagesManifest?: Promise<any>\n\n  constructor(\n    buildId: string,\n    assetPrefix: string,\n    initialPage: string,\n    initialStyleSheets: string[]\n  ) {\n    this.initialPage = initialPage\n    this.initialStyleSheets = initialStyleSheets\n\n    this.buildId = buildId\n    this.assetPrefix = assetPrefix\n\n    this.pageCache = {}\n    this.pageRegisterEvents = mitt()\n    this.loadingRoutes = {\n      // By default these 2 pages are being loaded in the initial html\n      '/_app': true,\n    }\n\n    // TODO: get rid of this limitation for rendering the error page\n    if (initialPage !== '/_error') {\n      this.loadingRoutes[initialPage] = true\n    }\n\n    this.promisedBuildManifest = new Promise((resolve) => {\n      if ((window as any).__BUILD_MANIFEST) {\n        resolve((window as any).__BUILD_MANIFEST)\n      } else {\n        ;(window as any).__BUILD_MANIFEST_CB = () => {\n          resolve((window as any).__BUILD_MANIFEST)\n        }\n      }\n    })\n\n    /** @type {Promise<Set<string>>} */\n    this.promisedSsgManifest = new Promise((resolve) => {\n      if ((window as any).__SSG_MANIFEST) {\n        resolve((window as any).__SSG_MANIFEST)\n      } else {\n        ;(window as any).__SSG_MANIFEST_CB = () => {\n          resolve((window as any).__SSG_MANIFEST)\n        }\n      }\n    })\n  }\n\n  getPageList() {\n    if (process.env.NODE_ENV === 'production') {\n      return this.promisedBuildManifest!.then(\n        (buildManifest) => buildManifest.sortedPages\n      )\n    } else {\n      if ((window as any).__DEV_PAGES_MANIFEST) {\n        return (window as any).__DEV_PAGES_MANIFEST.pages\n      } else {\n        if (!this.promisedDevPagesManifest) {\n          this.promisedDevPagesManifest = fetch(\n            `${this.assetPrefix}/_next/static/development/_devPagesManifest.json`\n          )\n            .then((res) => res.json())\n            .then((manifest) => {\n              ;(window as any).__DEV_PAGES_MANIFEST = manifest\n              return manifest.pages\n            })\n            .catch((err) => {\n              console.log(`Failed to fetch devPagesManifest`, err)\n            })\n        }\n        return this.promisedDevPagesManifest\n      }\n    }\n  }\n\n  // Returns a promise for the dependencies for a particular route\n  private getDependencies(route: string): Promise<string[]> {\n    return this.promisedBuildManifest!.then((m) => {\n      return m[route]\n        ? m[route].map((url) => `${this.assetPrefix}/_next/${encodeURI(url)}`)\n        : Promise.reject(pageLoadError(route))\n    })\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  getDataHref(href: string, asPath: string, ssg: boolean) {\n    const { pathname: hrefPathname, searchParams, search } = parseRelativeUrl(\n      href\n    )\n    const query = searchParamsToUrlQuery(searchParams)\n    const { pathname: asPathname } = parseRelativeUrl(asPath)\n    const route = normalizeRoute(hrefPathname)\n\n    const getHrefForSlug = (path: string) => {\n      const dataRoute = getAssetPathFromRoute(path, '.json')\n      return addBasePath(\n        `/_next/data/${this.buildId}${dataRoute}${ssg ? '' : search}`\n      )\n    }\n\n    let isDynamic: boolean = isDynamicRoute(route),\n      interpolatedRoute: string | undefined\n    if (isDynamic) {\n      const dynamicRegex = getRouteRegex(route)\n      const dynamicGroups = dynamicRegex.groups\n      const dynamicMatches =\n        // Try to match the dynamic route against the asPath\n        getRouteMatcher(dynamicRegex)(asPathname) ||\n        // Fall back to reading the values from the href\n        // TODO: should this take priority; also need to change in the router.\n        query\n\n      interpolatedRoute = route\n      if (\n        !Object.keys(dynamicGroups).every((param) => {\n          let value = dynamicMatches[param] || ''\n          const { repeat, optional } = dynamicGroups[param]\n\n          // support single-level catch-all\n          // TODO: more robust handling for user-error (passing `/`)\n          let replaced = `[${repeat ? '...' : ''}${param}]`\n          if (optional) {\n            replaced = `${!value ? '/' : ''}[${replaced}]`\n          }\n          if (repeat && !Array.isArray(value)) value = [value]\n\n          return (\n            (optional || param in dynamicMatches) &&\n            // Interpolate group into data URL if present\n            (interpolatedRoute =\n              interpolatedRoute!.replace(\n                replaced,\n                repeat\n                  ? (value as string[]).map(escapePathDelimiters).join('/')\n                  : escapePathDelimiters(value as string)\n              ) || '/')\n          )\n        })\n      ) {\n        interpolatedRoute = '' // did not satisfy all requirements\n\n        // n.b. We ignore this error because we handle warning for this case in\n        // development in the `<Link>` component directly.\n      }\n    }\n\n    return isDynamic\n      ? interpolatedRoute && getHrefForSlug(interpolatedRoute)\n      : getHrefForSlug(route)\n  }\n\n  /**\n   * @param {string} href the route href (file-system path)\n   * @param {string} asPath the URL as shown in browser (virtual path); used for dynamic routes\n   */\n  prefetchData(href: string, asPath: string) {\n    const { pathname: hrefPathname } = parseRelativeUrl(href)\n    const route = normalizeRoute(hrefPathname)\n    return this.promisedSsgManifest!.then(\n      (s: ClientSsgManifest, _dataHref?: string) => {\n        requestIdleCallback(() => {\n          // Check if the route requires a data file\n          s.has(route) &&\n            // Try to generate data href, noop when falsy\n            (_dataHref = this.getDataHref(href, asPath, true)) &&\n            // noop when data has already been prefetched (dedupe)\n            !document.querySelector(\n              `link[rel=\"${relPrefetch}\"][href^=\"${_dataHref}\"]`\n            ) &&\n            // Inject the `<link rel=prefetch>` tag for above computed `href`.\n            appendLink(_dataHref, relPrefetch, 'fetch')\n        })\n      }\n    )\n  }\n\n  loadPage(route: string): Promise<GoodPageCache> {\n    route = normalizeRoute(route)\n\n    return new Promise<GoodPageCache>((resolve, reject) => {\n      // If there's a cached version of the page, let's use it.\n      const cachedPage = this.pageCache[route]\n      if (cachedPage) {\n        if ('error' in cachedPage) {\n          reject(cachedPage.error)\n        } else {\n          resolve(cachedPage)\n        }\n        return\n      }\n\n      const fire = (pageToCache: PageCacheEntry) => {\n        this.pageRegisterEvents.off(route, fire)\n        delete this.loadingRoutes[route]\n\n        if ('error' in pageToCache) {\n          reject(pageToCache.error)\n        } else {\n          resolve(pageToCache)\n        }\n      }\n\n      // Register a listener to get the page\n      this.pageRegisterEvents.on(route, fire)\n\n      if (!this.loadingRoutes[route]) {\n        this.loadingRoutes[route] = true\n        if (process.env.NODE_ENV === 'production') {\n          this.getDependencies(route)\n            .then((deps) => {\n              const pending: Promise<any>[] = []\n              deps.forEach((d) => {\n                if (\n                  d.endsWith('.js') &&\n                  !document.querySelector(`script[src^=\"${d}\"]`)\n                ) {\n                  pending.push(loadScript(d))\n                }\n\n                // Prefetch CSS as it'll be needed when the page JavaScript\n                // evaluates. This will only trigger if explicit prefetching is\n                // disabled for a <Link>... prefetching in this case is desirable\n                // because we *know* it's going to be used very soon (page was\n                // loaded).\n                if (\n                  d.endsWith('.css') &&\n                  !document.querySelector(\n                    `link[rel=\"${relPreload}\"][href^=\"${d}\"]`\n                  )\n                ) {\n                  // This is not pushed into `pending` because we don't need to\n                  // wait for these to resolve. To prevent an unhandled\n                  // rejection, we swallow the error which is handled later in\n                  // the rendering cycle (this is just a preload optimization).\n                  appendLink(d, relPreload, 'style').catch(() => {\n                    /* ignore preload error */\n                  })\n                }\n              })\n              return Promise.all(pending)\n            })\n            .catch((err) => {\n              // Mark the page as failed to load if any of its required scripts\n              // fail to load:\n              this.pageCache[route] = { error: err }\n              fire({ error: err })\n            })\n        } else {\n          // Development only. In production the page file is part of the build manifest\n          route = normalizeRoute(route)\n          let scriptRoute = getAssetPathFromRoute(route, '.js')\n\n          const url = `${this.assetPrefix}/_next/static/chunks/pages${encodeURI(\n            scriptRoute\n          )}`\n          loadScript(url).catch((err) => {\n            // Mark the page as failed to load if its script fails to load:\n            this.pageCache[route] = { error: err }\n            fire({ error: err })\n          })\n        }\n      }\n    })\n  }\n\n  // This method if called by the route code.\n  registerPage(route: string, regFn: () => any) {\n    const register = (styleSheets: string[]) => {\n      try {\n        const mod = regFn()\n        const pageData: PageCacheEntry = {\n          page: mod.default || mod,\n          mod,\n          styleSheets,\n        }\n        this.pageCache[route] = pageData\n        this.pageRegisterEvents.emit(route, pageData)\n      } catch (error) {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Wait for webpack to become idle if it's not.\n      // More info: https://github.com/vercel/next.js/pull/1511\n      if ((module as any).hot && (module as any).hot.status() !== 'idle') {\n        console.log(\n          `Waiting for webpack to become \"idle\" to initialize the page: \"${route}\"`\n        )\n\n        const check = (status: string) => {\n          if (status === 'idle') {\n            ;(module as any).hot.removeStatusHandler(check)\n            register(\n              /* css is handled via style-loader in development */\n              []\n            )\n          }\n        }\n        ;(module as any).hot.status(check)\n        return\n      }\n    }\n\n    const promisedDeps: Promise<string[]> =\n      // Shared styles will already be on the page:\n      route === '/_app' ||\n      // We use `style-loader` in development:\n      process.env.NODE_ENV !== 'production'\n        ? Promise.resolve([])\n        : route === this.initialPage\n        ? Promise.resolve(this.initialStyleSheets)\n        : // Tests that this does not block hydration:\n          // test/integration/css-fixtures/hydrate-without-deps/\n          this.getDependencies(route)\n    promisedDeps.then(\n      (deps) => register(deps.filter((d) => d.endsWith('.css'))),\n      (error) => {\n        this.pageCache[route] = { error }\n        this.pageRegisterEvents.emit(route, { error })\n      }\n    )\n  }\n\n  /**\n   * @param {string} route\n   * @param {boolean} [isDependency]\n   */\n  prefetch(route: string, isDependency?: boolean): Promise<void> {\n    // https://github.com/GoogleChromeLabs/quicklink/blob/453a661fa1fa940e2d2e044452398e38c67a98fb/src/index.mjs#L115-L118\n    // License: Apache 2.0\n    let cn\n    if ((cn = (navigator as any).connection)) {\n      // Don't prefetch if using 2G or if Save-Data is enabled.\n      if (cn.saveData || /2g/.test(cn.effectiveType)) return Promise.resolve()\n    }\n\n    /** @type {string} */\n    let url\n    if (isDependency) {\n      url = route\n    } else {\n      if (process.env.NODE_ENV !== 'production') {\n        route = normalizeRoute(route)\n\n        const ext =\n          process.env.__NEXT_MODERN_BUILD && hasNoModule ? '.module.js' : '.js'\n        const scriptRoute = getAssetPathFromRoute(route, ext)\n\n        url = `${this.assetPrefix}/_next/static/${encodeURIComponent(\n          this.buildId\n        )}/pages${encodeURI(scriptRoute)}`\n      }\n    }\n\n    return Promise.all(\n      document.querySelector(`link[rel=\"${relPrefetch}\"][href^=\"${url}\"]`)\n        ? []\n        : [\n            url &&\n              appendLink(\n                url,\n                relPrefetch,\n                url.endsWith('.css') ? 'style' : 'script'\n              ),\n            process.env.NODE_ENV === 'production' &&\n              !isDependency &&\n              this.getDependencies(route).then((urls) =>\n                Promise.all(\n                  urls.map((dependencyUrl) =>\n                    this.prefetch(dependencyUrl, true)\n                  )\n                )\n              ),\n          ]\n    ).then(\n      // do not return any data\n      () => {},\n      // swallow prefetch errors\n      () => {}\n    )\n  }\n}\n"]}