{"version":3,"sources":["lib/eslint/writeDefaultConfig.ts"],"sourcesContent":["import { promises as fs } from 'fs'\nimport chalk from 'chalk'\nimport os from 'os'\nimport path from 'path'\n\nimport * as CommentJson from 'next/dist/compiled/comment-json'\n\nexport async function writeDefaultConfig(\n  eslintrcFile: string | null,\n  pkgJsonPath: string | null,\n  packageJsonConfig: { eslintConfig: any } | null\n) {\n  const defaultConfig = {\n    extends: 'next',\n  }\n\n  if (eslintrcFile) {\n    const content = await fs.readFile(eslintrcFile, { encoding: 'utf8' }).then(\n      (txt) => txt.trim().replace(/\\n/g, ''),\n      () => null\n    )\n\n    if (\n      content === '' ||\n      content === '{}' ||\n      content === '---' ||\n      content === 'module.exports = {}'\n    ) {\n      const ext = path.extname(eslintrcFile)\n\n      let newFileContent\n      if (ext === '.yaml' || ext === '.yml') {\n        newFileContent = \"extends: 'next'\"\n      } else {\n        newFileContent = CommentJson.stringify(defaultConfig, null, 2)\n\n        if (ext === '.js') {\n          newFileContent = 'module.exports = ' + newFileContent\n        }\n      }\n\n      await fs.writeFile(eslintrcFile, newFileContent + os.EOL)\n\n      console.log(\n        chalk.green(\n          `We detected an empty ESLint configuration file (${chalk.bold(\n            path.basename(eslintrcFile)\n          )}) and updated it for you to include the base Next.js ESLint configuration.`\n        )\n      )\n    }\n  } else if (packageJsonConfig?.eslintConfig) {\n    // Creates .eslintrc only if package.json's eslintConfig field is empty\n    if (Object.entries(packageJsonConfig?.eslintConfig).length === 0) {\n      packageJsonConfig.eslintConfig = defaultConfig\n\n      if (pkgJsonPath)\n        await fs.writeFile(\n          pkgJsonPath,\n          CommentJson.stringify(packageJsonConfig, null, 2) + os.EOL\n        )\n\n      console.log(\n        chalk.green(\n          `We detected an empty ${chalk.bold(\n            'eslintConfig'\n          )} field in package.json and updated it for you to include the base Next.js ESLint configuration.`\n        )\n      )\n    }\n  } else {\n    await fs.writeFile(\n      '.eslintrc.json',\n      CommentJson.stringify(defaultConfig, null, 2) + os.EOL\n    )\n\n    console.log(\n      chalk.green(\n        `We created the ${chalk.bold(\n          '.eslintrc.json'\n        )} file for you and included the base Next.js ESLint configuration.`\n      )\n    )\n  }\n}\n"],"names":[],"mappings":";;;;QAOsB,kBAAkB,GAAlB,kBAAkB;AAPT,GAAI,CAAJ,GAAI;AACjB,GAAO,CAAP,MAAO;AACV,GAAI,CAAJ,GAAI;AACF,GAAM,CAAN,KAAM;AAEX,GAAW,CAAX,WAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;;;eAED,kBAAkB,CACtC,YAA2B,EAC3B,WAA0B,EAC1B,iBAA+C,EAC/C,CAAC;IACD,KAAK,CAAC,aAAa;QACjB,OAAO,GAAE,IAAM;;IAGjB,EAAE,EAAE,YAAY,EAAE,CAAC;QACjB,KAAK,CAAC,OAAO,SAjBc,GAAI,UAiBN,QAAQ,CAAC,YAAY;YAAI,QAAQ,GAAE,IAAM;WAAI,IAAI,EACvE,GAAG,GAAK,GAAG,CAAC,IAAI,GAAG,OAAO;cACrB,IAAI;;QAGZ,EAAE,EACA,OAAO,WACP,OAAO,MAAK,EAAI,KAChB,OAAO,MAAK,GAAK,KACjB,OAAO,MAAK,mBAAqB,GACjC,CAAC;YACD,KAAK,CAAC,GAAG,GAzBE,KAAM,SAyBA,OAAO,CAAC,YAAY;YAErC,GAAG,CAAC,cAAc;YAClB,EAAE,EAAE,GAAG,MAAK,KAAO,KAAI,GAAG,MAAK,IAAM,GAAE,CAAC;gBACtC,cAAc,IAAG,eAAiB;YACpC,CAAC,MAAM,CAAC;gBACN,cAAc,GA7BV,WAAW,CA6Bc,SAAS,CAAC,aAAa,EAAE,IAAI,EAAE,CAAC;gBAE7D,EAAE,EAAE,GAAG,MAAK,GAAK,GAAE,CAAC;oBAClB,cAAc,IAAG,iBAAmB,IAAG,cAAc;gBACvD,CAAC;YACH,CAAC;kBAvCwB,GAAI,UAyCpB,SAAS,CAAC,YAAY,EAAE,cAAc,GAvCtC,GAAI,SAuCwC,GAAG;YAExD,OAAO,CAAC,GAAG,CA1CC,MAAO,SA2CX,KAAK,EACR,gDAAgD,EA5CzC,MAAO,SA4C0C,IAAI,CA1CtD,KAAM,SA2CN,QAAQ,CAAC,YAAY,GAC1B,0EAA0E;QAGlF,CAAC;IACH,CAAC,MAAM,EAAE,EAAE,iBAAiB,aAAjB,iBAAiB,UAAjB,CAA+B,QAA/B,CAA+B,GAA/B,iBAAiB,CAAE,YAAY,EAAE,CAAC;QAC3C,EAAuE,AAAvE,qEAAuE;QACvE,EAAE,EAAE,MAAM,CAAC,OAAO,CAAC,iBAAiB,aAAjB,iBAAiB,UAAjB,CAA+B,QAA/B,CAA+B,GAA/B,iBAAiB,CAAE,YAAY,EAAE,MAAM,KAAK,CAAC,EAAE,CAAC;YACjE,iBAAiB,CAAC,YAAY,GAAG,aAAa;YAE9C,EAAE,EAAE,WAAW,QAxDU,GAAI,UAyDlB,SAAS,CAChB,WAAW,EArDT,WAAW,CAsDD,SAAS,CAAC,iBAAiB,EAAE,IAAI,EAAE,CAAC,IAzD3C,GAAI,SAyD8C,GAAG;YAG9D,OAAO,CAAC,GAAG,CA7DC,MAAO,SA8DX,KAAK,EACR,qBAAqB,EA/Dd,MAAO,SA+De,IAAI,EAChC,YAAc,GACd,+FAA+F;QAGvG,CAAC;IACH,CAAC,MAAM,CAAC;cAtEqB,GAAI,UAuEtB,SAAS,EAChB,cAAgB,GAnEV,WAAW,CAoEL,SAAS,CAAC,aAAa,EAAE,IAAI,EAAE,CAAC,IAvEnC,GAAI,SAuEsC,GAAG;QAGxD,OAAO,CAAC,GAAG,CA3EG,MAAO,SA4Eb,KAAK,EACR,eAAe,EA7EN,MAAO,SA6EO,IAAI,EAC1B,cAAgB,GAChB,iEAAiE;IAGzE,CAAC;AACH,CAAC"}